<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Fields</title>
    ~[wc:commonscripts] 
    <link href="/images/css/screen.css" rel="stylesheet" media="screen">
    <link href="/images/css/print.css" rel="stylesheet" media="print">
    <style>
      .kwe_ud_btn{padding:6px 10px;border:1px solid #aaa;background:#f7f7f7;border-radius:4px;cursor:pointer;text-decoration:none;display:inline-block}
      .kwe_ud_btn_disabled{opacity:.45;pointer-events:none}
      table{border-collapse:collapse;width:100%}
      th,td{border:1px solid #ddd;padding:8px}
      th{background:#f0f0f0;text-align:left}
      .kwe_ud_hint{color:#666;font-size:12px}
      .kwe_ud_right{text-align:right}
    </style>
</head>
<body>
    ~[wc:admin_header_css] 
    <a href="/" target="_top">Start Page</a> &gt; File Service Tools
    ~[wc:admin_navigation_css]

<h1>Category Fields</h1>

<div style="margin:20px 0; border:1px solid #ddd; padding:10px;">
~[tlist_sql;
  SELECT
    c.ID catid,
    c.NAME catname,
    (SELECT COUNT(*) FROM U_UD_RECORD r WHERE r.CATEGORY_ID = c.ID) rec_count,
    CASE WHEN (SELECT COUNT(*) FROM U_UD_RECORD r WHERE r.CATEGORY_ID = c.ID) = 0 
      THEN 'unlocked'
      ELSE 'locked'
    END lock_status
  FROM U_UD_CATEGORY c
  WHERE TRIM(TO_CHAR(c.ID)) = TRIM('~(gpv.catid)')
]
<p><strong>Category: ~(catname)</strong> (ID: ~(catid))</p>
<p class="kwe_ud_hint">Fields can only be edited if record count is 0. [Records: ~(rec_count)]</p>
<p>
  <a class="kwe_ud_btn" href="categories.html">‚Üê Back to Categories</a>
  <a href="fielddefs-edit.html?id=-1&catid=~(catid)" class="kwe_ud_btn" 
     style="~(lock_status=='unlocked'?'':'opacity:.45;pointer-events:none')">+ New Field</a>
</p>
[/tlist_sql]
</div>

  <table>
    <thead>
      <tr>
        <th>Label</th>
        <th>Key</th>
        <th>Type</th>
        <th>Required</th>
        <th>Sort</th>
        <th class="kwe_ud_right">Actions</th>
      </tr>
    </thead>
    <tbody>
~[tlist_sql;
  SELECT
    f.ID fid,
    f.FIELD_LABEL field_label,
    f.FIELD_KEY field_key,
    f.VALUE_TYPE value_type,
    f.REQUIRED required,
    f.SORT_ORDER sort_order,
    CASE WHEN (SELECT COUNT(*) FROM U_UD_RECORD r WHERE r.CATEGORY_ID = f.CATEGORY_ID) = 0
      THEN '<a class=kwe_ud_btn href=fielddefs-edit.html?id=' || f.ID || '&catid=' || TRIM('~(gpv.catid)') || '>Edit</a> <a class=kwe_ud_btn href=fielddefs-delete.html?id=' || f.ID || '&catid=' || TRIM('~(gpv.catid)') || '>Delete</a>'
      ELSE '<span class="kwe_ud_btn kwe_ud_btn_disabled">Edit</span> <span class="kwe_ud_btn kwe_ud_btn_disabled">Delete</span>'
    END action_btn
  FROM U_UD_FIELDDEF f
  WHERE TRIM(TO_CHAR(f.CATEGORY_ID)) = TRIM('~(gpv.catid)')
  ORDER BY NVL(f.SORT_ORDER, 9999), UPPER(f.FIELD_LABEL)
]
      <tr>
        <td>~(field_label)</td>
        <td>~(field_key)</td>
        <td>~(value_type)</td>
        <td>~(required)</td>
        <td>~(sort_order)</td>
        <td class="kwe_ud_right">
          ~(action_btn)
        </td>
      </tr>
[/tlist_sql]
    </tbody>
  </table>

~[tlist_sql;
  SELECT 'No fields defined for this category yet.' msg FROM dual
  WHERE NOT EXISTS (
    SELECT 1 FROM U_UD_FIELDDEF f WHERE TRIM(TO_CHAR(f.CATEGORY_ID)) = TRIM('~(gpv.catid)')
  )
]
<tr><td colspan="6">~(msg)</td></tr>
[/tlist_sql]

  <p class="kwe_ud_hint">
    Value Types supported in this starter UI: STRING, INT, DECIMAL, DATE, BOOL, TEXT
  </p>


</body>
</html>
