<!DOCTYPE html>
<html>
<head>
  ~[wc:admin_header_css]
  <title>User Data Categories</title>
  <style>
    .btn{padding:6px 10px;border:1px solid #aaa;background:#f7f7f7;border-radius:4px;cursor:pointer;text-decoration:none;display:inline-block}
    .btn-danger{border-color:#c00}
    .btn-disabled{opacity:.45;pointer-events:none}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #ddd;padding:8px}
    th{background:#f0f0f0;text-align:left}
    .right{text-align:right}
    .hint{color:#666;font-size:12px}
  </style>
</head>
<body>
~[wc:admin_header]
~[wc:admin_navigation]

<h1>User Data Categories</h1>

<p class="hint">
  Categories define "types" of user data (MAP Scores, Club Experience, Skillsets).  
  You can only delete (or edit fields) when no user records exist for that category.
</p>

<p>
  <a class="btn" href="categories-edit.html?id=-1">+ New Category</a>
</p>

<table id="catTable">
  <thead>
    <tr>
      <th>Name</th>
      <th>Code</th>
      <th>Active</th>
      <th>Sort</th>
      <th>Records</th>
      <th class="right">Actions</th>
    </tr>
  </thead>
  <tbody>
    ~[tlist_sql;
      SELECT
        c.ID id,
        c.NAME name,
        c.CODE code,
        c.IS_ACTIVE is_active,
        c.SORT_ORDER sort_order,
        (SELECT COUNT(*) FROM U_UD_RECORD r WHERE r.CATEGORY_ID = c.ID) rec_count
      FROM U_UD_CATEGORY c
      ORDER BY NVL(c.SORT_ORDER, 9999), UPPER(c.NAME)
    ]
    <tr>
      <td>~(name)</td>
      <td>~(code)</td>
      <td>~(is_active)</td>
      <td>~(sort_order)</td>
      <td>~(rec_count)</td>
      <td class="right">
        <a class="btn" href="categories-edit.html?id=~(id)">Edit</a>
        <a class="btn" href="fielddefs.html?catid=~(id)">Fields</a>
        ~[if#canDelete.~(rec_count)=0]
          <a class="btn btn-danger" href="categories-delete.html?id=~(id)">Delete</a>
        [else#canDelete]
          <span class="btn btn-danger btn-disabled" title="Locked: category has records">Delete</span>
        [/if#canDelete]
      </td>
    </tr>
    ~[/tlist_sql]
  </tbody>
</table>

~[wc:admin_footer]
</body>
</html>
